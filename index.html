<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Feud Game Show</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#172554">
    <meta name="description" content="A customizable Family Feud style game for parties and events.">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Custom Animations */
        @keyframes flip-in {
            0% { transform: rotateX(-90deg); opacity: 0; }
            100% { transform: rotateX(0); opacity: 1; }
        }
        .animate-flip-in {
            animation: flip-in 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .animate-pulse-slow {
            animation: pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .text-stroke-white {
            -webkit-text-stroke: 1px white;
        }
        @media (min-width: 768px) {
            .text-stroke-white {
                -webkit-text-stroke: 2px white;
            }
        }
        
        .text-shadow-sm {
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        /* Hide Scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Custom Scrollbar for Settings */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }
    </style>
</head>
<body class="bg-blue-950 text-white font-sans selection:bg-yellow-500 selection:text-blue-900 overflow-x-hidden touch-manipulation">

    <!-- App Container -->
    <div id="app" class="min-h-screen relative flex flex-col pb-safe">
        <!-- Content will be injected here by JavaScript -->
    </div>

    <!-- Modal Container -->
    <div id="modal-container" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md p-4 animate-fade-in">
        <div class="bg-slate-900 border-2 md:border-4 border-yellow-500 rounded-2xl p-6 md:p-8 max-w-md w-full shadow-2xl transform scale-100">
            <h3 id="modal-title" class="text-xl md:text-2xl font-bold text-white mb-4 flex items-center gap-3">
                <!-- Icon and Title injected here -->
            </h3>
            <p id="modal-message" class="text-slate-300 text-base md:text-lg mb-8 leading-relaxed"></p>
            <div class="flex gap-4 justify-end">
                <button id="modal-cancel" class="flex-1 md:flex-none px-4 py-3 rounded-lg bg-slate-700 hover:bg-slate-600 text-white font-bold transition-transform active:scale-95">Cancel</button>
                <button id="modal-confirm" class="flex-1 md:flex-none px-4 py-3 rounded-lg bg-yellow-500 hover:bg-yellow-400 text-blue-900 font-black transition-transform active:scale-95 shadow-lg">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Feedback Overlay (Ting/X) -->
    <div id="feedback-container" class="hidden fixed inset-0 z-50 flex items-center justify-center pointer-events-none bg-black/40 backdrop-blur-sm p-4">
        <!-- Content injected here -->
    </div>

    <script>
        // --- INITIAL DATA ---
        const INITIAL_GAME_DATA = [
            {
                question: "Give a reason why a student is absent",
                answers: [
                    { text: "Sick / Fever", points: 35 },
                    { text: "Overslept", points: 25 },
                    { text: "No Allowance", points: 15 },
                    { text: "Traffic", points: 10 },
                    { text: "Raining / Flood", points: 8 },
                    { text: "Skipping Class", points: 7 }
                ]
            },
            {
                question: "Common breakfast items",
                answers: [
                    { text: "Eggs / Scrambled", points: 30 },
                    { text: "Fried Rice", points: 25 },
                    { text: "Hotdog", points: 15 },
                    { text: "Dried Fish", points: 12 },
                    { text: "Bread / Pandesal", points: 10 },
                    { text: "Bacon / Meat", points: 8 }
                ]
            },
            {
                question: "Where do friends usually hang out?",
                answers: [
                    { text: "Mall / Shopping", points: 40 },
                    { text: "Cinema", points: 20 },
                    { text: "Friend's House", points: 15 },
                    { text: "Cafe / Coffee Shop", points: 10 },
                    { text: "Park", points: 8 },
                    { text: "Fast Food", points: 7 }
                ]
            }
        ];

        const INITIAL_FAST_MONEY_DATA = [
            {
                question: "Name a fruit you eat with the skin on",
                answers: [
                    { text: "Apple", points: 40 },
                    { text: "Grape", points: 30 },
                    { text: "Pear", points: 15 },
                    { text: "Peach", points: 10 },
                    { text: "Plum", points: 5 }
                ]
            },
            {
                question: "Name something people lose",
                answers: [
                    { text: "Keys", points: 35 },
                    { text: "Phone", points: 20 },
                    { text: "Wallet/Purse", points: 15 },
                    { text: "Glasses", points: 10 },
                    { text: "Remote", points: 5 }
                ]
            },
            {
                question: "A job that requires a lot of standing",
                answers: [
                    { text: "Teacher", points: 30 },
                    { text: "Security Guard", points: 25 },
                    { text: "Chef/Cook", points: 20 },
                    { text: "Cashier", points: 15 },
                    { text: "Nurse", points: 10 }
                ]
            },
            {
                question: "Name a type of bear",
                answers: [
                    { text: "Grizzly/Brown", points: 40 },
                    { text: "Polar", points: 30 },
                    { text: "Panda", points: 15 },
                    { text: "Teddy", points: 10 },
                    { text: "Black Bear", points: 5 }
                ]
            },
            {
                question: "Something you buy by the roll",
                answers: [
                    { text: "Toilet Paper", points: 50 },
                    { text: "Paper Towels", points: 25 },
                    { text: "Tape", points: 15 },
                    { text: "Wrapping Paper", points: 5 },
                    { text: "Aluminum Foil", points: 5 }
                ]
            }
        ];

        // --- GLOBAL STATE ---
        const store = {
            gameData: JSON.parse(JSON.stringify(INITIAL_GAME_DATA)),
            fastMoneyData: JSON.parse(JSON.stringify(INITIAL_FAST_MONEY_DATA)),
            currentRoundIndex: 0,
            phase: 'intro', 
            scores: { teamA: 0, teamB: 0 },
            teamNames: { teamA: "TEAM A", teamB: "TEAM B" },
            roundScore: 0,
            strikes: 0,
            revealedAnswers: [],
            currentTeam: null,
            fastMoneyWinner: null,
            faceOffTurn: null,
            faceOffData: { teamA: null, teamB: null },
            
            // Fast Money Specific
            fmTimer: 0,
            isTimerRunning: false,
            timerInterval: null,
            fmAnswers: {
                p1: ['', '', '', '', ''],
                p2: ['', '', '', '', ''],
                p1Points: [null, null, null, null, null],
                p2Points: [null, null, null, null, null],
                total: 0
            },
            // Settings
            settingsTab: 'main',
            editingRoundIndex: null,
            tempRoundData: null
        };

        // --- DOM ELEMENTS ---
        const app = document.getElementById('app');
        const modalContainer = document.getElementById('modal-container');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm');
        const modalCancelBtn = document.getElementById('modal-cancel');
        const feedbackContainer = document.getElementById('feedback-container');

        // --- SOUND / FEEDBACK LOGIC ---
        function playSound(type) {
            feedbackContainer.classList.remove('hidden');
            if (type === 'correct') {
                feedbackContainer.innerHTML = `<div class="text-green-400 text-6xl md:text-9xl font-black drop-shadow-[0_0_50px_rgba(74,222,128,1)] animate-bounce text-stroke-white text-center">TING!</div>`;
            } else if (type === 'wrong') {
                feedbackContainer.innerHTML = `<div class="text-red-500 text-8xl md:text-[12rem] font-black drop-shadow-[0_0_50px_rgba(239,68,68,1)] animate-pulse text-center">X</div>`;
            }
            setTimeout(() => {
                feedbackContainer.classList.add('hidden');
                feedbackContainer.innerHTML = '';
            }, 1000);
        }

        // --- MODAL LOGIC ---
        function showModal(message, onConfirm, isAlert = false) {
            modalTitle.innerHTML = isAlert 
                ? `<i data-lucide="alert-circle" class="text-yellow-500 w-6 h-6 md:w-8 md:h-8"></i> Notice`
                : `<i data-lucide="alert-circle" class="text-blue-400 w-6 h-6 md:w-8 md:h-8"></i> Confirmation`;
            
            modalMessage.textContent = message;
            modalConfirmBtn.textContent = isAlert ? "OK" : "Confirm";
            modalCancelBtn.style.display = isAlert ? 'none' : 'block';
            
            modalContainer.classList.remove('hidden');
            lucide.createIcons();

            modalConfirmBtn.onclick = () => {
                modalContainer.classList.add('hidden');
                if (onConfirm) onConfirm();
            };
            modalCancelBtn.onclick = () => {
                modalContainer.classList.add('hidden');
            };
        }

        // --- TIMER LOGIC ---
        function startTimer() {
            if (store.isTimerRunning) return;
            store.isTimerRunning = true;
            renderFastMoneyInput(store.phase === 'fast-money-p1' ? 'p1' : 'p2'); 

            store.timerInterval = setInterval(() => {
                if (store.fmTimer > 0) {
                    store.fmTimer--;
                    const timerDisplay = document.getElementById('timer-display');
                    if (timerDisplay) {
                        timerDisplay.innerText = store.fmTimer + "s";
                        if(store.fmTimer <= 5) timerDisplay.classList.add('text-red-500', 'animate-pulse');
                    }
                } else {
                    stopTimer();
                    playSound('wrong');
                }
            }, 1000);
        }

        function stopTimer() {
            store.isTimerRunning = false;
            clearInterval(store.timerInterval);
            renderFastMoneyInput(store.phase === 'fast-money-p1' ? 'p1' : 'p2'); 
        }

        function toggleTimer() {
            if (store.isTimerRunning) stopTimer();
            else startTimer();
        }

        // --- CORE GAME ACTIONS ---
        function startGame() {
            if (store.gameData.length === 0) return showModal("Please add at least one round in settings!", null, true);
            if (!store.teamNames.teamA.trim() || !store.teamNames.teamB.trim()) return showModal("Please enter team names!", null, true);
            
            store.scores = { teamA: 0, teamB: 0 };
            store.fmAnswers = { p1: ['', '', '', '', ''], p2: ['', '', '', '', ''], p1Points: [null, null, null, null, null], p2Points: [null, null, null, null, null], total: 0 };
            store.currentRoundIndex = 0;
            startRound(0);
        }

        function startRound(index) {
            store.phase = 'face-off';
            store.roundScore = 0;
            store.strikes = 0;
            store.revealedAnswers = [];
            store.currentTeam = null;
            store.faceOffTurn = 'teamA';
            store.faceOffData = { teamA: null, teamB: null };
            renderApp();
        }

        function revealAnswer(idx) {
            if (!store.revealedAnswers.includes(idx)) {
                store.revealedAnswers.push(idx);
                store.roundScore += store.gameData[store.currentRoundIndex].answers[idx].points;
                playSound('correct');
                renderApp();
                return true;
            }
            return false;
        }

        function handleFaceOffAnswer(idx) {
            const rank = idx !== null ? idx : 999;
            if (idx !== null) revealAnswer(idx);
            else playSound('wrong');

            store.faceOffData[store.faceOffTurn] = rank;
            
            if (store.faceOffTurn === 'teamA') {
                store.faceOffTurn = 'teamB';
                renderApp();
            } else {
                const rankA = store.faceOffData.teamA;
                const rankB = store.faceOffData.teamB;
                let winner = 'teamA';
                if (rankB < rankA) winner = 'teamB';
                store.faceOffTurn = 'decision';
                store.currentTeam = winner;
                renderApp();
            }
        }

        function handlePlayOrPass(decision) {
            if (decision === 'pass') {
                store.currentTeam = store.currentTeam === 'teamA' ? 'teamB' : 'teamA';
            }
            store.phase = 'playing';
            renderApp();
        }

        function handleStrike() {
            playSound('wrong');
            store.strikes++;
            if (store.phase === 'playing' && store.strikes >= 3) {
                store.phase = 'steal';
            } else if (store.phase === 'steal') {
                finishRound(store.currentTeam);
                return;
            }
            renderApp();
        }

        function handleStealSuccess(idx) {
            revealAnswer(idx);
            const stealingTeam = store.currentTeam === 'teamA' ? 'teamB' : 'teamA';
            finishRound(stealingTeam);
        }

        function handleRoundAnswer(idx) {
            const success = revealAnswer(idx);
            if (success) {
                const roundData = store.gameData[store.currentRoundIndex];
                if (store.revealedAnswers.length === roundData.answers.length) {
                    finishRound(store.currentTeam);
                }
            }
        }

        function finishRound(winningTeam) {
            store.scores[winningTeam] += store.roundScore;
            store.phase = 'round-end';
            renderApp();
        }

        function nextRound() {
            if (store.currentRoundIndex + 1 < store.gameData.length) {
                store.currentRoundIndex++;
                startRound(store.currentRoundIndex);
            } else {
                if (store.scores.teamA > store.scores.teamB) store.fastMoneyWinner = 'teamA';
                else if (store.scores.teamB > store.scores.teamA) store.fastMoneyWinner = 'teamB';
                else store.fastMoneyWinner = 'teamA';
                
                store.phase = 'fast-money-intro';
                renderApp();
            }
        }

        // --- FAST MONEY LOGIC ---
        function handleFmInput(player, index, value) {
            store.fmAnswers[player][index] = value;
            if (player === 'p2') {
                const p1Ans = store.fmAnswers.p1[index] || "";
                const isDup = value.trim() !== '' && value.trim().toLowerCase() === p1Ans.trim().toLowerCase();
                const dupEl = document.getElementById(`fm-dup-${index}`);
                if (dupEl) {
                    if (isDup) dupEl.classList.remove('hidden');
                    else dupEl.classList.add('hidden');
                }
                const inputEl = document.getElementById(`fm-input-${index}`);
                if (inputEl) {
                   if (isDup) inputEl.classList.add('border-red-500');
                   else inputEl.classList.remove('border-red-500');
                }
            }
        }

        function assignFmPoints(player, qIndex, points) {
            const pointsArray = player === 'p1' ? store.fmAnswers.p1Points : store.fmAnswers.p2Points;
            const oldPoints = pointsArray[qIndex] || 0;
            pointsArray[qIndex] = points;
            store.fmAnswers.total = store.fmAnswers.total - oldPoints + points;
            
            if (points > 0) playSound('correct');
            else playSound('wrong');
            renderApp(); 
        }

        // --- SETTINGS HELPER FUNCTIONS ---
        function addNewRound() {
            const newRound = {
                question: "New Question",
                answers: [{ text: "Answer 1", points: 10 }]
            };
            if (store.settingsTab === 'main') {
                store.gameData.push(newRound);
                editRound(store.gameData.length - 1);
            } else {
                if(store.fastMoneyData.length >= 5) {
                    return showModal("Fast Money is limited to exactly 5 questions.", null, true);
                }
                store.fastMoneyData.push(newRound);
                editRound(store.fastMoneyData.length - 1);
            }
            renderApp();
        }

        function editRound(index) {
            store.editingRoundIndex = index;
            const sourceData = store.settingsTab === 'main' ? store.gameData : store.fastMoneyData;
            store.tempRoundData = JSON.parse(JSON.stringify(sourceData[index]));
            renderApp();
        }

        function saveRound() {
            if (store.editingRoundIndex === null || !store.tempRoundData) return;
            
            // Filter empty answers
            store.tempRoundData.answers = store.tempRoundData.answers.filter(a => a.text.trim() !== "");
            
            if (store.settingsTab === 'main') {
                store.gameData[store.editingRoundIndex] = JSON.parse(JSON.stringify(store.tempRoundData));
            } else {
                store.fastMoneyData[store.editingRoundIndex] = JSON.parse(JSON.stringify(store.tempRoundData));
            }
            
            store.editingRoundIndex = null;
            store.tempRoundData = null;
            renderApp();
            showModal("Changes saved successfully!", null, true);
        }

        function deleteRound(index) {
            showModal("Are you sure you want to delete this round?", () => {
                if (store.settingsTab === 'main') {
                    store.gameData.splice(index, 1);
                } else {
                    store.fastMoneyData.splice(index, 1);
                }
                
                if (store.editingRoundIndex === index) {
                    store.editingRoundIndex = null;
                    store.tempRoundData = null;
                } else if (store.editingRoundIndex > index) {
                    store.editingRoundIndex--;
                }
                renderApp();
            });
        }

        function updateTempRound(field, value) {
            if (!store.tempRoundData) return;
            store.tempRoundData[field] = value;
        }

        function updateTempAnswer(index, field, value) {
            if (!store.tempRoundData || !store.tempRoundData.answers[index]) return;
            if (field === 'points') value = parseInt(value) || 0;
            store.tempRoundData.answers[index][field] = value;
        }

        function addTempAnswerSlot() {
            if (!store.tempRoundData) return;
            store.tempRoundData.answers.push({ text: "", points: 0 });
            renderApp();
        }

        function removeTempAnswerSlot(index) {
            if (!store.tempRoundData) return;
            store.tempRoundData.answers.splice(index, 1);
            renderApp();
        }

        function setSettingsTab(tab) {
            store.settingsTab = tab;
            store.editingRoundIndex = null;
            store.tempRoundData = null;
            renderApp();
        }

        function openSettings() {
            store.phase = 'settings';
            store.editingRoundIndex = null;
            store.tempRoundData = null;
            store.settingsTab = 'main';
            renderApp();
        }

        // --- RENDERERS ---

        function renderApp() {
            app.innerHTML = '';
            
            switch (store.phase) {
                case 'intro': renderIntro(); break;
                case 'settings': renderSettings(); break;
                case 'fast-money-intro': renderFastMoneyIntro(); break;
                case 'fast-money-p1': renderFastMoneyInput('p1'); break;
                case 'fast-money-p1-reveal': renderFastMoneyReveal('p1'); break;
                case 'fast-money-p2': renderFastMoneyInput('p2'); break;
                case 'fast-money-p2-reveal': renderFastMoneyReveal('p2'); break;
                case 'fast-money-result': renderFastMoneyResult(); break;
                case 'game-over': renderGameOver(); break;
                default: renderMainGame(); break; 
            }
            lucide.createIcons();
        }

        function renderIntro() {
            app.innerHTML = `
            <div class="min-h-screen bg-blue-950 flex flex-col items-center justify-center p-4 relative overflow-hidden">
                <div class="absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-blue-600 rounded-full blur-[100px] md:blur-[150px] opacity-30 pointer-events-none"></div>
                <div class="absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-yellow-500 rounded-full blur-[100px] md:blur-[150px] opacity-20 pointer-events-none"></div>
                
                <div class="bg-slate-900/80 backdrop-blur-sm p-6 md:p-12 rounded-3xl border-4 md:border-[6px] border-yellow-500 shadow-2xl text-center max-w-3xl w-full relative">
                    <button onclick="openSettings()" class="absolute top-4 right-4 md:top-6 md:right-6 text-blue-400 hover:text-white transition-colors p-2"><i data-lucide="settings" class="w-6 h-6 md:w-8 md:h-8"></i></button>
                    
                    <div class="mb-8 md:mb-10">
                        <h1 class="text-4xl md:text-8xl font-black text-yellow-400 mb-2 drop-shadow-[0_4px_0_rgba(0,0,0,0.5)] tracking-tighter italic">FAMILY FEUD</h1>
                        <h2 class="text-lg md:text-3xl font-bold text-white tracking-[0.3em] md:tracking-[0.5em] uppercase text-shadow-sm">Game Show</h2>
                    </div>
                    
                    <div class="flex flex-col gap-6 md:gap-8 items-center w-full max-w-lg mx-auto">
                        <div class="w-full space-y-4 md:space-y-6">
                            <div class="relative group">
                                <label class="absolute -top-2.5 left-4 bg-blue-600 px-2 text-[10px] md:text-xs text-white font-black uppercase tracking-wider rounded">LEFT TEAM</label>
                                <input type="text" value="${store.teamNames.teamA}" oninput="store.teamNames.teamA = this.value" class="w-full bg-blue-950 border-2 md:border-4 border-blue-600 rounded-xl p-3 md:p-4 text-center text-xl md:text-2xl font-black text-white focus:border-yellow-400 outline-none transition-colors shadow-inner placeholder-blue-700" placeholder="ENTER NAME">
                            </div>
                            <div class="text-yellow-500 font-black text-lg md:text-xl italic tracking-widest drop-shadow-md">VS</div>
                            <div class="relative group">
                                <label class="absolute -top-2.5 left-4 bg-blue-600 px-2 text-[10px] md:text-xs text-white font-black uppercase tracking-wider rounded">RIGHT TEAM</label>
                                <input type="text" value="${store.teamNames.teamB}" oninput="store.teamNames.teamB = this.value" class="w-full bg-blue-950 border-2 md:border-4 border-blue-600 rounded-xl p-3 md:p-4 text-center text-xl md:text-2xl font-black text-white focus:border-yellow-400 outline-none transition-colors shadow-inner placeholder-blue-700" placeholder="ENTER NAME">
                            </div>
                        </div>
                        <button onclick="startGame()" class="w-full bg-gradient-to-b from-yellow-400 to-yellow-600 hover:from-yellow-300 hover:to-yellow-500 text-blue-950 font-black text-xl md:text-3xl py-4 md:py-6 px-12 rounded-full shadow-[0_4px_0_rgb(161,98,7)] md:shadow-[0_6px_0_rgb(161,98,7)] transform transition active:translate-y-1 active:shadow-none flex items-center justify-center gap-2 md:gap-4 mt-4 uppercase tracking-wider">
                            <i data-lucide="play" class="w-6 h-6 md:w-10 md:h-10 fill-current"></i> START GAME
                        </button>
                    </div>
                </div>
            </div>`;
        }

        function renderSettings() {
            const listData = store.settingsTab === 'main' ? store.gameData : store.fastMoneyData;
            
            let roundsListHtml = listData.map((round, idx) => `
                <div onclick="editRound(${idx})" class="p-4 rounded-lg cursor-pointer border-2 transition-all ${store.editingRoundIndex === idx ? 'bg-slate-700 border-yellow-500 shadow-md' : 'bg-slate-900 border-slate-700 hover:border-slate-500'}">
                    <p class="text-sm font-black text-yellow-500 mb-1 uppercase tracking-wider">${store.settingsTab === 'main' ? `Round ${idx + 1}` : `Question ${idx + 1}`}</p>
                    <p class="text-sm text-slate-200 truncate font-medium">${round.question}</p>
                </div>
            `).join('');

            let editorHtml = '';
            if (store.editingRoundIndex !== null && store.tempRoundData) {
                let answersInputs = store.tempRoundData.answers.map((ans, aIdx) => `
                    <div class="flex gap-3 items-center">
                        <span class="text-slate-500 font-mono font-bold w-6 text-right">${aIdx + 1}.</span>
                        <input type="text" placeholder="Answer Text" value="${ans.text}" oninput="updateTempAnswer(${aIdx}, 'text', this.value)" class="flex-1 bg-slate-900 border border-slate-600 rounded p-3 text-sm font-medium focus:border-blue-500 outline-none text-white">
                        <input type="number" placeholder="Pts" value="${ans.points}" oninput="updateTempAnswer(${aIdx}, 'points', this.value)" class="w-24 bg-slate-900 border border-slate-600 rounded p-3 text-sm text-center font-mono font-bold focus:border-blue-500 outline-none text-white">
                        <button onclick="removeTempAnswerSlot(${aIdx})" class="text-red-500 hover:text-red-400 p-2 hover:bg-red-500/10 rounded"><i data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                `).join('');

                editorHtml = `
                    <div class="space-y-8">
                        <div>
                            <label class="block text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Question</label>
                            <input type="text" value="${store.tempRoundData.question}" oninput="updateTempRound('question', this.value)" class="w-full bg-slate-900 border-2 border-slate-600 rounded-lg p-4 text-white text-lg font-bold focus:border-yellow-500 outline-none transition-colors">
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <label class="block text-xs font-black text-slate-400 uppercase tracking-widest">Answers & Points</label>
                                <button onclick="addTempAnswerSlot()" class="text-sm text-green-400 hover:text-green-300 font-bold flex items-center gap-1 bg-slate-900 px-3 py-1 rounded border border-green-900 hover:border-green-400 transition-colors"><i data-lucide="plus" class="w-4 h-4"></i> Add Slot</button>
                            </div>
                            <div class="space-y-3 max-h-[40vh] overflow-y-auto pr-2 custom-scrollbar">
                                ${answersInputs}
                            </div>
                        </div>
                        <div class="flex justify-between pt-6 border-t border-slate-700">
                            <button onclick="deleteRound(${store.editingRoundIndex})" class="text-red-500 hover:text-red-400 flex items-center gap-2 px-6 py-3 rounded-lg hover:bg-red-500/10 font-bold transition-colors"><i data-lucide="trash-2" class="w-5 h-5"></i> Delete Round</button>
                            <button onclick="saveRound()" class="bg-yellow-500 hover:bg-yellow-400 text-blue-900 font-black px-8 py-3 rounded-lg flex items-center gap-2 shadow-lg hover:shadow-yellow-500/20 transition-all"><i data-lucide="save" class="w-5 h-5"></i> Save Changes</button>
                        </div>
                    </div>
                `;
            } else {
                editorHtml = `<div class="h-full flex flex-col items-center justify-center text-slate-600"><i data-lucide="edit-2" class="w-16 h-16 mb-6 opacity-20"></i><p class="text-xl font-bold">Select a round to edit or create new.</p></div>`;
            }

            app.innerHTML = `
            <div class="min-h-screen bg-slate-950 text-white p-4 md:p-6 font-sans">
                <div class="max-w-7xl mx-auto">
                    <div class="flex justify-between items-center mb-8 border-b border-slate-700 pb-4">
                        <h1 class="text-3xl md:text-4xl font-black text-yellow-400 flex items-center gap-3 tracking-wide">
                            <i data-lucide="settings" class="w-8 h-8 md:w-10 md:h-10"></i> GAME SETTINGS
                        </h1>
                        <button onclick="store.phase='intro'; renderApp()" class="bg-blue-600 hover:bg-blue-500 px-6 md:px-8 py-3 rounded-lg font-bold shadow-lg transition-transform active:scale-95">Back to Menu</button>
                    </div>

                    <!-- TABS -->
                    <div class="flex gap-4 mb-6 overflow-x-auto pb-2">
                        <button onclick="setSettingsTab('main')" class="px-6 md:px-8 py-3 rounded-lg font-black text-sm md:text-lg whitespace-nowrap transition-colors ${store.settingsTab === 'main' ? 'bg-yellow-500 text-blue-900 shadow-lg' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}">MAIN ROUNDS</button>
                        <button onclick="setSettingsTab('fastmoney')" class="px-6 md:px-8 py-3 rounded-lg font-black text-sm md:text-lg whitespace-nowrap transition-colors ${store.settingsTab === 'fastmoney' ? 'bg-yellow-500 text-blue-900 shadow-lg' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}">FAST MONEY (${store.fastMoneyData.length}/5)</button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- LIST -->
                        <div class="lg:col-span-1 bg-slate-800 rounded-xl p-5 border border-slate-700 h-fit shadow-xl max-h-[40vh] lg:max-h-[70vh] overflow-y-auto">
                            <div class="flex justify-between items-center mb-6 border-b border-slate-600 pb-4 sticky top-0 bg-slate-800 z-10">
                                <h3 class="font-bold text-slate-300 text-xl">${store.settingsTab === 'main' ? 'Game Rounds' : 'FM Questions'}</h3>
                                <button onclick="addNewRound()" class="bg-green-600 hover:bg-green-500 p-2 rounded-lg text-white shadow-md transition-transform active:scale-95"><i data-lucide="plus" class="w-6 h-6"></i></button>
                            </div>
                            <div class="space-y-3">
                                ${roundsListHtml}
                            </div>
                        </div>

                        <!-- EDITOR -->
                        <div class="lg:col-span-2 bg-slate-800 rounded-xl p-6 md:p-8 border border-slate-700 shadow-xl">
                            ${editorHtml}
                        </div>
                    </div>
                </div>
            </div>
            `;
        }

        function renderMainGame() {
            const currentRound = store.gameData[store.currentRoundIndex];
            
            let answersHtml = '';
            for(let i=0; i<8; i++) {
                const ans = currentRound.answers[i];
                if(ans) {
                    const revealed = store.revealedAnswers.includes(i);
                    const onClick = (store.phase === 'face-off' || store.phase === 'playing' || store.phase === 'steal') 
                        ? (store.phase === 'face-off' ? `handleFaceOffAnswer(${i})` : store.phase === 'playing' ? `handleRoundAnswer(${i})` : `handleStealSuccess(${i})`)
                        : '';
                    
                    answersHtml += `
                    <div onclick="${!revealed ? onClick : ''}" class="relative rounded-lg md:rounded-xl overflow-hidden h-16 md:h-24 flex items-center shadow-md md:shadow-2xl cursor-pointer transition-all transform active:scale-95 border md:border-2 ${revealed ? 'bg-gradient-to-b from-blue-600 to-blue-800 border-yellow-400' : 'bg-gradient-to-br from-blue-900 to-blue-950 border-blue-600 hover:border-blue-400'}">
                        ${!revealed ? `
                        <div class="w-full h-full flex items-center justify-center relative group">
                            <div class="w-10 h-10 md:w-14 md:h-14 rounded-full bg-blue-800 border-2 md:border-4 border-blue-600 group-hover:border-yellow-400 flex items-center justify-center text-blue-400 group-hover:text-yellow-400 font-black text-xl md:text-3xl shadow-inner transition-colors">${i + 1}</div>
                        </div>` : `
                        <div class="w-full h-full flex items-center justify-between px-3 md:px-6 text-white animate-flip-in">
                            <span class="font-bold text-sm md:text-3xl uppercase tracking-wide truncate mr-2 md:mr-4 text-shadow-sm">${ans.text}</span>
                            <div class="bg-black border border-white/20 min-w-[3rem] md:min-w-[4rem] h-10 md:h-14 flex items-center justify-center shadow-inner">
                                <span class="font-mono text-xl md:text-4xl font-bold text-yellow-400">${ans.points}</span>
                            </div>
                        </div>`}
                    </div>`;
                } else {
                     answersHtml += `<div class="h-16 md:h-24 border md:border-2 border-blue-900/40 rounded-lg md:rounded-xl bg-blue-900/10"></div>`;
                }
            }

            // Controls Panel HTML
            let controlsHtml = '';
            if (store.phase === 'face-off' && store.faceOffTurn !== 'decision') {
                controlsHtml = `
                <div class="bg-blue-800/50 p-4 md:p-6 rounded-xl text-center border-2 border-blue-600/50 animate-pulse-slow">
                    <p class="text-sm md:text-lg text-blue-200 font-bold mb-1 uppercase tracking-wide">Face-Off Turn</p>
                    <p class="text-xl md:text-3xl font-black text-yellow-400 uppercase mb-4 drop-shadow-md truncate">${store.faceOffTurn === 'teamA' ? store.teamNames.teamA : store.teamNames.teamB}</p>
                    <button onclick="handleFaceOffAnswer(null)" class="w-full bg-red-600 hover:bg-red-500 text-white font-black py-3 md:py-4 rounded-xl shadow-[0_4px_0_rgb(153,27,27)] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2 text-base md:text-lg">
                        <i data-lucide="x" class="w-5 h-5 md:w-6 md:h-6"></i> NO ANSWER
                    </button>
                </div>`;
            } else if (store.phase === 'face-off' && store.faceOffTurn === 'decision') {
                controlsHtml = `
                <div class="bg-yellow-900/30 p-4 md:p-6 rounded-xl border-2 border-yellow-500/50 text-center">
                    <p class="font-bold text-lg md:text-xl text-yellow-100 mb-1">WINNER</p>
                    <p class="text-2xl md:text-3xl font-black text-yellow-400 uppercase mb-4 md:mb-6 truncate">${store.currentTeam === 'teamA' ? store.teamNames.teamA : store.teamNames.teamB}</p>
                    <div class="grid grid-cols-2 xl:grid-cols-1 gap-3">
                        <button onclick="handlePlayOrPass('play')" class="bg-green-600 hover:bg-green-500 text-white font-black py-3 md:py-4 rounded-xl text-base md:text-xl shadow-md">PLAY</button>
                        <button onclick="handlePlayOrPass('pass')" class="bg-orange-600 hover:bg-orange-500 text-white font-black py-3 md:py-4 rounded-xl text-base md:text-xl shadow-md">PASS</button>
                    </div>
                </div>`;
            } else if (store.phase === 'playing') {
                controlsHtml = `
                <div class="bg-blue-900/30 p-4 md:p-6 rounded-xl border border-blue-700/50 flex flex-col h-full justify-between">
                    <div class="text-center mb-4 md:mb-6">
                        <p class="text-blue-300 font-bold uppercase tracking-widest text-[10px] md:text-xs mb-1">Current Player</p>
                        <p class="text-xl md:text-3xl font-black text-white uppercase truncate">${store.currentTeam === 'teamA' ? store.teamNames.teamA : store.teamNames.teamB}</p>
                    </div>
                    <button onclick="handleStrike()" class="w-full bg-red-600 hover:bg-red-500 text-white font-black text-4xl md:text-6xl py-4 md:py-8 rounded-xl md:rounded-2xl shadow-[0_4px_0_rgb(153,27,27)] md:shadow-[0_6px_0_rgb(153,27,27)] active:shadow-none active:translate-y-2 transition-all flex items-center justify-center mb-2">
                        <i data-lucide="x" class="w-10 h-10 md:w-16 md:h-16"></i>
                    </button>
                </div>`;
            } else if (store.phase === 'steal') {
                controlsHtml = `
                <div class="bg-purple-900/40 p-4 md:p-6 rounded-xl border-2 border-purple-500 animate-pulse text-center">
                    <h3 class="font-black text-2xl md:text-3xl text-purple-300 mb-2 tracking-widest italic">STEAL!</h3>
                    <p class="text-white text-base md:text-lg font-bold mb-4 md:mb-6">Chance for <span class="text-yellow-400 uppercase block text-lg md:text-2xl mt-1 truncate">${store.currentTeam === 'teamA' ? store.teamNames.teamB : store.teamNames.teamA}</span></p>
                    <button onclick="handleStrike()" class="w-full bg-red-600 hover:bg-red-500 text-white font-black py-3 md:py-4 rounded-xl mt-2 md:mt-4 text-base md:text-lg">WRONG ANSWER</button>
                </div>`;
            } else if (store.phase === 'round-end') {
                controlsHtml = `
                <div class="bg-green-900/30 p-4 md:p-6 rounded-xl border border-green-500/50 text-center flex flex-col justify-center h-full">
                    <h3 class="text-2xl md:text-3xl font-black text-green-400 uppercase italic mb-2">Round Done!</h3>
                    <button onclick="nextRound()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-blue-950 font-black py-3 md:py-5 rounded-xl shadow-[0_4px_0_rgb(161,98,7)] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2 text-lg md:text-xl mt-2 md:mt-4">
                        NEXT <i data-lucide="arrow-right"></i>
                    </button>
                </div>`;
            }

            app.innerHTML = `
            <!-- HEADER / SCOREBOARD -->
            <div class="bg-blue-950/95 border-b-4 md:border-b-8 border-yellow-500 p-2 md:p-4 shadow-2xl relative z-10 backdrop-blur-md sticky top-0">
                <div class="max-w-7xl mx-auto flex justify-between items-center gap-2 md:gap-4">
                    <!-- Team A -->
                    <div class="flex flex-col items-center p-2 md:p-4 rounded-xl md:rounded-2xl w-1/3 md:min-w-[140px] border-2 md:border-4 ${store.currentTeam === 'teamA' ? 'bg-blue-800 border-yellow-400 scale-105' : 'bg-blue-900/50 border-blue-800 opacity-70'}">
                        <span class="text-yellow-400 font-black text-[10px] md:text-sm uppercase truncate w-full text-center">${store.teamNames.teamA}</span>
                        <span class="text-3xl md:text-5xl font-black font-mono bg-black text-white px-2 md:px-6 py-1 md:py-2 rounded md:rounded-lg border md:border-2 border-gray-700 shadow-inner w-full text-center">${store.scores.teamA}</span>
                    </div>

                    <!-- Center Info -->
                    <div class="flex flex-col items-center w-1/3">
                        <div class="bg-black px-4 md:px-8 py-2 md:py-3 rounded-lg md:rounded-xl border-2 md:border-4 border-yellow-600 mb-1 md:mb-3 relative overflow-hidden w-full text-center">
                            <span class="text-4xl md:text-6xl font-mono text-yellow-500 font-black tracking-widest relative z-10">${store.roundScore.toString().padStart(3, '0')}</span>
                        </div>
                        <div class="flex gap-1 md:gap-3 h-6 md:h-10 justify-center w-full">
                            ${[0,1,2].map(i => `<div class="w-6 h-6 md:w-10 md:h-10 flex items-center justify-center font-black text-lg md:text-3xl rounded md:rounded-lg border md:border-2 ${i < store.strikes ? 'bg-red-600 border-red-400 text-white' : 'bg-blue-900/30 border-blue-800 text-blue-800'}">${i < store.strikes ? 'X' : ''}</div>`).join('')}
                        </div>
                    </div>

                    <!-- Team B -->
                    <div class="flex flex-col items-center p-2 md:p-4 rounded-xl md:rounded-2xl w-1/3 md:min-w-[140px] border-2 md:border-4 ${store.currentTeam === 'teamB' ? 'bg-blue-800 border-yellow-400 scale-105' : 'bg-blue-900/50 border-blue-800 opacity-70'}">
                        <span class="text-yellow-400 font-black text-[10px] md:text-sm uppercase truncate w-full text-center">${store.teamNames.teamB}</span>
                        <span class="text-3xl md:text-5xl font-black font-mono bg-black text-white px-2 md:px-6 py-1 md:py-2 rounded md:rounded-lg border md:border-2 border-gray-700 shadow-inner w-full text-center">${store.scores.teamB}</span>
                    </div>
                </div>
            </div>

            <div class="max-w-7xl mx-auto p-3 md:p-6 lg:p-8 grid grid-cols-1 xl:grid-cols-4 gap-4 md:gap-8 flex-1 h-full w-full">
                <!-- GAME BOARD AREA -->
                <div class="xl:col-span-3 flex flex-col gap-4 md:gap-6">
                    <div class="bg-gradient-to-r from-blue-800 to-blue-700 p-4 md:p-8 rounded-2xl md:rounded-3xl border-2 md:border-4 border-blue-500 shadow-lg md:shadow-2xl text-center relative overflow-hidden">
                        <h3 class="relative z-10 text-blue-200 text-[10px] md:text-sm font-black uppercase tracking-[0.2em] md:tracking-[0.3em] mb-1 md:mb-3">Round ${store.currentRoundIndex + 1}</h3>
                        <p class="relative z-10 text-xl md:text-5xl font-bold text-white leading-tight drop-shadow-md">"${currentRound.question}"</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 md:gap-6">
                        ${answersHtml}
                    </div>
                </div>

                <!-- HOST CONTROLS AREA -->
                <div class="xl:col-span-1 bg-slate-900 rounded-2xl md:rounded-3xl border-2 border-slate-700 p-4 md:p-6 flex flex-col gap-4 shadow-xl md:shadow-2xl h-fit xl:sticky xl:top-4 order-last xl:order-none">
                     <div class="border-b-2 border-slate-700 pb-3 md:pb-4 mb-1 md:mb-2">
                        <h4 class="font-black text-yellow-500 uppercase tracking-widest text-xs md:text-sm flex items-center gap-2"><i data-lucide="settings" class="w-4 h-4"></i> Host Controls</h4>
                        <div class="flex items-center justify-between mt-2 bg-slate-800 rounded px-3 py-1">
                             <span class="text-[10px] md:text-xs text-slate-400 uppercase font-bold">Status</span>
                             <span class="text-[10px] md:text-xs text-white font-black bg-blue-600 px-2 py-0.5 rounded uppercase">${store.phase.replace('-', ' ')}</span>
                        </div>
                    </div>
                    <div class="flex-1 flex flex-col gap-3 md:gap-4">
                        ${controlsHtml}
                    </div>
                    <div class="mt-auto pt-4 md:pt-6 border-t-2 border-slate-700 grid grid-cols-2 gap-2 md:gap-3">
                        <button onclick="showModal('Return to Main Menu?', () => { store.phase = 'intro'; renderApp(); })" class="flex flex-col items-center justify-center gap-1 bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white text-[10px] md:text-xs font-black py-3 md:py-4 rounded-lg border border-slate-700"><i data-lucide="home" class="w-4 h-4 md:w-5 md:h-5"></i> MENU</button>
                        <button onclick="showModal('Open Settings?', () => openSettings())" class="flex flex-col items-center justify-center gap-1 bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white text-[10px] md:text-xs font-black py-3 md:py-4 rounded-lg border border-slate-700"><i data-lucide="settings" class="w-4 h-4 md:w-5 md:h-5"></i> OPTIONS</button>
                    </div>
                </div>
            </div>`;
        }

        // --- FAST MONEY RENDERERS ---

        function renderFastMoneyIntro() {
            app.innerHTML = `
            <div class="min-h-screen bg-blue-950 flex flex-col items-center justify-center text-white p-4 text-center">
                <div class="max-w-4xl w-full bg-blue-900/50 backdrop-blur-md p-6 md:p-12 rounded-3xl border-4 border-yellow-500 shadow-2xl">
                    <h1 class="text-2xl md:text-4xl font-bold text-blue-300 mb-2 uppercase tracking-widest">End of Main Rounds</h1>
                    <h2 class="text-5xl md:text-9xl font-black text-white mb-8 md:mb-10 drop-shadow-lg italic">FAST MONEY!</h2>
                    <div class="bg-gradient-to-b from-blue-800 to-blue-900 p-6 md:p-10 rounded-2xl border-4 border-blue-500 text-center mb-8 md:mb-10 shadow-xl max-w-2xl mx-auto">
                        <p class="text-blue-200 text-sm md:text-lg font-bold uppercase tracking-widest mb-2 md:mb-4">Playing Team</p>
                        <p class="text-4xl md:text-7xl font-black text-yellow-300 drop-shadow-md truncate">
                            ${store.fastMoneyWinner === 'teamA' ? store.teamNames.teamA : store.teamNames.teamB}
                        </p>
                    </div>
                    <button onclick="store.phase='fast-money-p1'; store.fmTimer=20; renderApp()" class="bg-yellow-500 hover:bg-yellow-400 text-blue-900 font-black px-8 md:px-16 py-4 md:py-6 rounded-full text-xl md:text-3xl shadow-[0_6px_0_rgb(161,98,7)] transform transition active:translate-y-1 active:shadow-none w-full md:w-auto">
                        START PLAYER 1
                    </button>
                </div>
            </div>`;
        }

        function renderFastMoneyInput(player) {
            const nextPhase = player === 'p1' ? 'fast-money-p1-reveal' : 'fast-money-p2-reveal';
            const answers = store.fmAnswers[player];
            
            let inputsHtml = store.fastMoneyData.map((item, idx) => `
                <div class="bg-blue-800 p-3 md:p-5 rounded-xl border border-blue-600 shadow-md">
                    <div class="flex justify-between items-center mb-2">
                        <p class="text-xs md:text-sm text-blue-300 font-bold uppercase tracking-wider">Question ${idx + 1}</p>
                        <span id="fm-dup-${idx}" class="hidden text-red-500 text-xs font-black animate-pulse flex items-center gap-1"><i data-lucide="alert-circle" class="w-3 h-3 md:w-4 md:h-4"></i> DUPLICATE</span>
                    </div>
                    <p class="font-bold text-white text-base md:text-xl mb-2 md:mb-3 leading-snug">${item.question}</p>
                    <input 
                        id="fm-input-${idx}"
                        type="text" 
                        value="${answers[idx]}"
                        oninput="handleFmInput('${player}', ${idx}, this.value)"
                        placeholder="Type answer here..."
                        class="w-full p-3 md:p-4 rounded-lg bg-blue-950 text-yellow-300 font-bold text-lg md:text-2xl border-2 outline-none transition-colors border-blue-600 focus:border-yellow-400"
                    />
                </div>
            `).join('');

            app.innerHTML = `
            <div class="max-w-5xl mx-auto p-3 md:p-8 flex flex-col h-full w-full">
                <div class="flex flex-col md:flex-row justify-between items-center mb-4 md:mb-8 bg-blue-900/90 p-4 md:p-6 rounded-2xl border-2 border-blue-600 shadow-xl backdrop-blur-sm sticky top-0 z-20">
                    <div class="text-center md:text-left mb-2 md:mb-0">
                        <h2 class="text-2xl md:text-3xl font-black text-yellow-400 tracking-wider">FAST MONEY</h2>
                        <p class="text-blue-200 text-sm md:text-lg font-bold">${player === 'p1' ? 'PLAYER 1' : 'PLAYER 2'}</p>
                    </div>
                    <div class="flex items-center gap-4 md:gap-6">
                        <div id="timer-display" class="text-4xl md:text-6xl font-mono font-black ${store.fmTimer <= 5 && store.isTimerRunning ? 'text-red-500 animate-pulse' : 'text-white drop-shadow-md'}">
                            ${store.fmTimer}s
                        </div>
                        <button onclick="toggleTimer()" class="px-4 md:px-6 py-2 md:py-3 rounded-xl font-black text-sm md:text-lg shadow-lg transform transition active:scale-95 ${store.isTimerRunning ? 'bg-red-600 hover:bg-red-500 text-white' : 'bg-green-500 hover:bg-green-400 text-blue-900'}">
                            ${store.isTimerRunning ? 'PAUSE' : 'START TIMER'}
                        </button>
                    </div>
                </div>
                <div class="flex-1 space-y-3 md:space-y-4 overflow-y-auto pr-1 md:pr-2 pb-4">
                    ${inputsHtml}
                </div>
                <button onclick="stopTimer(); store.phase='${nextPhase}'; renderApp()" class="mt-4 md:mt-8 w-full bg-gradient-to-r from-yellow-500 to-yellow-400 hover:from-yellow-400 hover:to-yellow-300 text-blue-900 font-black text-xl md:text-2xl py-4 md:py-5 rounded-xl shadow-xl flex justify-center items-center gap-3 transform transition hover:scale-[1.01] active:scale-95">
                    SUBMIT ANSWERS <i data-lucide="arrow-right" class="w-6 h-6 md:w-8 md:h-8"></i>
                </button>
            </div>`;
        }

        function renderFastMoneyReveal(player) {
            const pointsArray = player === 'p1' ? store.fmAnswers.p1Points : store.fmAnswers.p2Points;
            
            let questionsHtml = store.fastMoneyData.map((item, idx) => {
                const surveyBtns = item.answers.map((sa, i) => 
                    `<button onclick="assignFmPoints('${player}', ${idx}, ${sa.points})" class="px-2 md:px-3 py-1 md:py-2 text-xs md:text-sm font-bold rounded-lg border-2 transition-all ${pointsArray[idx] === sa.points ? 'bg-green-600 border-green-400 text-white' : 'bg-blue-950 border-blue-700 text-blue-300 hover:border-blue-500'}">
                        ${sa.text} <span class="text-yellow-400 ml-1">(${sa.points})</span>
                    </button>`
                ).join('');

                return `
                <div class="flex flex-col bg-blue-800 p-3 md:p-4 rounded-xl border border-blue-700 shadow-lg">
                    <p class="text-blue-300 text-[10px] md:text-xs font-bold uppercase mb-2">Q${idx+1}: ${item.question}</p>
                    <div class="flex flex-col gap-2">
                        <!-- P1 -->
                        <div class="flex-1">
                            <div class="h-10 md:h-14 flex items-center justify-between px-2 md:px-4 rounded-lg border-2 ${player === 'p2' ? 'bg-blue-900/50 border-blue-800 text-gray-400' : 'bg-gradient-to-r from-blue-600 to-blue-500 border-blue-400 shadow-inner'}">
                                <span class="font-bold text-sm md:text-lg uppercase truncate mr-2">${store.fmAnswers.p1[idx] || "-"}</span>
                                <span class="font-mono text-lg md:text-2xl font-bold px-2 md:px-3 py-0.5 md:py-1 rounded ${store.fmAnswers.p1Points[idx] !== null ? 'bg-black text-yellow-400 border border-yellow-600' : 'bg-black/20 text-blue-300'}">
                                    ${store.fmAnswers.p1Points[idx] !== null ? store.fmAnswers.p1Points[idx] : "?"}
                                </span>
                            </div>
                            ${player === 'p1' ? `<div class="flex flex-wrap gap-2 mt-2 md:mt-3">${surveyBtns} 
                                <button onclick="assignFmPoints('${player}', ${idx}, 0)" class="px-2 md:px-3 py-1 md:py-2 text-xs md:text-sm font-bold rounded-lg border-2 transition-all ${pointsArray[idx] === 0 ? 'bg-red-600 border-red-400 text-white' : 'bg-blue-950 border-blue-700 text-blue-300'}">Zero (0)</button></div>` : ''}
                        </div>
                        <!-- P2 (Only if p2 playing) -->
                        ${player === 'p2' ? `
                        <div class="flex-1 pl-2 md:pl-4 border-l-2 md:border-l-4 border-blue-950/50 mt-1">
                            <div class="h-10 md:h-14 flex items-center justify-between px-2 md:px-4 rounded-lg bg-gradient-to-r from-blue-600 to-blue-500 border-2 border-blue-400 shadow-inner">
                                <span class="font-bold text-sm md:text-lg uppercase truncate mr-2">${store.fmAnswers.p2[idx] || "-"}</span>
                                <span class="font-mono text-lg md:text-2xl font-bold px-2 md:px-3 py-0.5 md:py-1 rounded ${store.fmAnswers.p2Points[idx] !== null ? 'bg-black text-yellow-400 border border-yellow-600' : 'bg-black/20 text-blue-300'}">
                                    ${store.fmAnswers.p2Points[idx] !== null ? store.fmAnswers.p2Points[idx] : "?"}
                                </span>
                            </div>
                            <div class="flex flex-wrap gap-2 mt-2 md:mt-3">${surveyBtns} <button onclick="assignFmPoints('${player}', ${idx}, 0)" class="px-2 md:px-3 py-1 md:py-2 text-xs md:text-sm font-bold rounded-lg border-2 transition-all ${pointsArray[idx] === 0 ? 'bg-red-600 border-red-400 text-white' : 'bg-blue-950 border-blue-700 text-blue-300'}">Zero (0)</button></div>
                        </div>` : ''}
                    </div>
                </div>`;
            }).join('');

            // Big Board Visual
            let bigBoardHtml = store.fastMoneyData.map((_, idx) => `
                <div class="flex gap-2 md:gap-3">
                    <div class="flex-1 bg-gradient-to-b from-blue-800 to-blue-900 border md:border-2 border-blue-500 h-10 md:h-16 flex items-center justify-between px-2 md:px-3 shadow-inner">
                        ${store.fmAnswers.p1Points[idx] !== null ? 
                            `<span class="text-white font-bold text-xs md:text-lg uppercase truncate">${store.fmAnswers.p1[idx]}</span>
                             <span class="text-white font-black font-mono text-lg md:text-2xl border-l md:border-l-2 border-blue-600 pl-2 md:pl-3 w-8 md:w-14 text-center">${store.fmAnswers.p1Points[idx]}</span>`
                            : '<div class="w-full h-full bg-blue-950/50"></div>'
                        }
                    </div>
                    ${player === 'p2' ? `
                    <div class="flex-1 bg-gradient-to-b from-blue-800 to-blue-900 border md:border-2 border-blue-500 h-10 md:h-16 flex items-center justify-between px-2 md:px-3 shadow-inner">
                        ${store.fmAnswers.p2Points[idx] !== null ? 
                            `<span class="text-white font-bold text-xs md:text-lg uppercase truncate">${store.fmAnswers.p2[idx]}</span>
                             <span class="text-white font-black font-mono text-lg md:text-2xl border-l md:border-l-2 border-blue-600 pl-2 md:pl-3 w-8 md:w-14 text-center">${store.fmAnswers.p2Points[idx]}</span>`
                            : '<div class="w-full h-full bg-blue-950/50"></div>'
                        }
                    </div>` : ''}
                </div>
            `).join('');

            app.innerHTML = `
            <div class="max-w-7xl mx-auto p-2 md:p-8 flex flex-col h-full w-full">
                <div class="flex flex-col md:flex-row justify-between items-center mb-4 md:mb-8 bg-blue-900/50 p-4 md:p-6 rounded-2xl border border-blue-700">
                    <div class="text-center md:text-left mb-2 md:mb-0">
                        <h2 class="text-2xl md:text-4xl font-black text-yellow-400 uppercase tracking-widest drop-shadow-md">FAST MONEY REVEAL</h2>
                        <p class="text-blue-200 text-sm md:text-lg font-bold">SCORING PHASE</p>
                    </div>
                    <div class="flex items-center gap-2 md:gap-4 bg-black/40 px-4 md:px-6 py-2 md:py-3 rounded-xl border border-blue-600 mt-2 md:mt-0">
                        <span class="text-blue-300 font-bold text-sm md:text-xl uppercase tracking-widest">TOTAL SCORE</span>
                        <span class="text-4xl md:text-6xl font-mono font-black text-yellow-400 drop-shadow-lg">${store.fmAnswers.total}</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-8 h-full">
                    <div class="space-y-3 overflow-y-auto pr-1 md:pr-2 max-h-[40vh] md:max-h-[60vh] lg:max-h-full">
                        ${questionsHtml}
                    </div>
                    <div class="bg-black border-4 md:border-[6px] border-yellow-500 rounded-xl md:rounded-2xl p-4 md:p-6 flex flex-col justify-center gap-2 md:gap-3 shadow-2xl lg:sticky lg:top-8 h-fit">
                        <div class="text-center mb-2 md:mb-4">
                            <h3 class="text-yellow-500 font-black text-lg md:text-2xl uppercase tracking-[0.2em] border-b-2 border-yellow-500/30 pb-2">Survey Says</h3>
                        </div>
                        ${bigBoardHtml}
                    </div>
                </div>

                <div class="mt-4 md:mt-8 flex justify-end">
                    ${player === 'p1' ? `
                    <button onclick="store.phase='fast-money-p2'; store.fmTimer=25; renderApp()" class="w-full md:w-auto bg-gradient-to-r from-yellow-500 to-yellow-400 hover:from-yellow-400 hover:to-yellow-300 text-blue-900 font-black px-8 md:px-10 py-3 md:py-4 rounded-xl text-lg md:text-2xl flex items-center justify-center gap-3 shadow-xl transform transition hover:scale-105 active:scale-95">
                        NEXT PLAYER (P2) <i data-lucide="users" class="w-6 h-6 md:w-8 md:h-8"></i>
                    </button>` : `
                    <button onclick="store.phase='fast-money-result'; renderApp()" class="w-full md:w-auto bg-gradient-to-r from-green-500 to-green-400 hover:from-green-400 hover:to-green-300 text-white font-black px-8 md:px-10 py-3 md:py-4 rounded-xl text-lg md:text-2xl flex items-center justify-center gap-3 shadow-xl transform transition hover:scale-105 active:scale-95">
                        FINAL RESULTS <i data-lucide="trophy" class="w-6 h-6 md:w-8 md:h-8"></i>
                    </button>`}
                </div>
            </div>`;
        }

        function renderFastMoneyResult() {
            const isWin = store.fmAnswers.total >= 200;
            app.innerHTML = `
            <div class="min-h-screen bg-blue-950 flex flex-col items-center justify-center text-white p-4 text-center">
                <div class="bg-slate-900/80 backdrop-blur p-6 md:p-12 rounded-3xl border-4 border-yellow-500 shadow-2xl max-w-4xl w-full">
                    ${isWin ? `
                        <h1 class="text-4xl md:text-8xl font-black text-yellow-400 mb-4 md:mb-6 animate-bounce drop-shadow-lg">GRAND WINNER!</h1>
                        <div class="flex justify-center mb-4 md:mb-8"><i data-lucide="trophy" class="w-20 h-20 md:w-32 md:h-32 text-yellow-300"></i></div>
                        <p class="text-xl md:text-3xl text-blue-200 font-bold mb-2">Congratulations to</p>
                        <p class="text-3xl md:text-7xl font-black text-white mb-8 md:mb-10 truncate">${store.fastMoneyWinner === 'teamA' ? store.teamNames.teamA : store.teamNames.teamB}</p>
                    ` : `
                        <h1 class="text-4xl md:text-8xl font-black text-gray-400 mb-4 md:mb-6 drop-shadow-lg">GAME OVER</h1>
                        <div class="flex justify-center mb-4 md:mb-8"><i data-lucide="x" class="w-20 h-20 md:w-32 md:h-32 text-red-500"></i></div>
                        <div class="bg-blue-900/50 p-4 md:p-6 rounded-xl border border-blue-700 mb-4 md:mb-6 inline-block">
                            <p class="text-lg md:text-2xl text-blue-200 font-bold">Total Score</p>
                            <p class="text-4xl md:text-6xl font-black text-white">${store.fmAnswers.total}</p>
                        </div>
                        <p class="text-lg md:text-2xl text-blue-300 font-bold mb-8 md:mb-10">Better luck next time!</p>
                    `}
                    
                    <div class="w-full bg-gray-800 rounded-full h-6 md:h-8 mb-8 md:mb-12 border-2 border-gray-600 overflow-hidden relative max-w-xl mx-auto">
                        <div class="absolute top-0 left-0 h-full bg-gradient-to-r from-green-500 to-green-400 transition-all duration-1000" style="width: ${Math.min(100, (store.fmAnswers.total / 200) * 100)}%"></div>
                        <div class="absolute top-0 left-1/2 w-1 h-full bg-red-500 z-10" title="Goal: 200"></div>
                        <span class="absolute inset-0 flex items-center justify-center text-[10px] md:text-xs font-bold text-white drop-shadow-md z-20">${store.fmAnswers.total} / 200</span>
                    </div>

                    <button onclick="store.phase='intro'; renderApp()" class="bg-blue-600 hover:bg-blue-500 text-white font-black px-8 md:px-12 py-3 md:py-5 rounded-full text-lg md:text-2xl shadow-lg transition-transform active:scale-95">RETURN TO MENU</button>
                </div>
            </div>`;
        }

        
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('ServiceWorker registration successful'))
                    .catch(err => console.log('ServiceWorker registration failed: ', err));
            });
        }

        // Initialize
        renderApp();
    </script>
</body>
</html>